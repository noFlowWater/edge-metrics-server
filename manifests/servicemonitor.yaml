---
# ServiceMonitor는 Prometheus Operator의 CRD입니다.
# Prometheus Operator가 설치되어 있어야 작동합니다.
# 설치: helm install monitoring prometheus-community/kube-prometheus-stack -n monitoring
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: edge-devices
  namespace: monitoring
  labels:
    app: edge-metrics
    prometheus: kube-prometheus
spec:
  # app=edge-exporter 레이블을 가진 모든 Service를 자동 감지
  selector:
    matchLabels:
      app: edge-exporter
  endpoints:
  - port: metrics
    interval: 30s
    path: /metrics
    # 타임아웃 설정 (선택)
    # scrapeTimeout: 10s
    # relabeling 설정 (선택, 메트릭 레이블 추가/수정)
    # relabelings:
    # - sourceLabels: [__meta_kubernetes_service_label_device_id]
    #   targetLabel: device_id
    # - sourceLabels: [__meta_kubernetes_service_label_device_type]
    #   targetLabel: device_type
